;5 December 2002 -- PDP-11 System Routines

; Print Character
; Input: R2 (low byte) = ASCII code of character
002000 110237
002002 177566
002004 105537
002006 177564
002010 100375
002012 000207

; Print number (in octal)
; Input: R4 = 16 bit number to print
002020 010046
002022 010146
002024 010246
002026 010400
002030 012701
002032 000005
002034 000257
002036 005002
002040 006100
002042 103001
002044 005202
002046 062702
002050 000060
002052 004737
002054 002000
002056 010402
002060 010100
002062 005300
002064 005400
002066 072200
002070 072200
002072 072200
002074 042702
002076 177770
002100 062702
002102 000060
002104 004737
002106 002000
002110 077116
002112 012602
002114 012601
002116 012600
002120 000207

; Print CR-LF
002130 010246
002132 012702
002134 000012
002136 004737
002140 002000
002142 012702
002144 000015
002146 004737
002150 002000
002152 012602
002154 000207

;Print address packet (address contents)
;In: R3 = address of packet to print
002160 010246
002162 010446
002164 010304
002166 004737
002170 002020
002172 012702
002174 000040
002176 004737
002200 002000
002202 011304
002204 004737
002206 002020
002210 004737
002212 002130
002214 012604
002216 012602
002220 000207

;Print String
;Input: R3 = pointer to string descriptor
002240 010246
002242 010346
002244 010446
002246 012304
002250 001405
002252 005002
002254 112302
002256 004737
002260 002000
002262 077405
002264 012604
002266 012603
002270 012602
002272 000207

;Read Character (blocking read)
;Output: R2 (low byte) = ASCII character read
002300 105737
002302 177560
002304 100375
002306 113702
002310 177562
002312 000207

;Read String (strips trailing CR/LF)
;Input: R3 = pointer to string descriptor
;       (R3) = maximum string length
;Output: (R3) = filled string descriptor
002330 010046
002332 010246
002334 010300 ; Configure extents (SP = max, SP + 2 = min)
002336 005200
002340 005200 
002342 010046
002344 011346
002346 060016

002350 004737  ; Read character
002352 002300

002354 120227
002356 000015
002360 001442  ; LF
002362 120227
002364 000012 
002366 001437  ; CR
002370 120227
002372 000010
002374 001405  ; BS
002376 120227
002400 000177 
002402 001003  ; not DEL
002404 012702  ; Convert DEL->BS
002406 000010
002410 005300

002412 020016  ; Upper extent
002414 003407  ; Bound OK
002416 011600  ; Enforce upper bound

002420 010246  ; Force cursor to stop
002422 012702
002424 000010
002426 004737
002430 002000
002432 012602

002434 020066  ; Lower extent
002436 000002
002440 002003  ; Bound OK
002442 016600  ; Enforce lower bound
002444 000002
002446 000406  ; Stop cursor motion

002450 004737  ; Print character
002452 002000

002454 120227
002456 000010
002460 001401
002462 110220
002464 000731  ; Bottom of loop

002466 166600  ; Compute length
002470 000002
002472 010013
002474 012600  ; Cleanup
002476 012600

002500 012602
002502 012600

002504 000207

; Compare string descriptors
; Input: R3 = Pointer to First string
;        R4 = pointer to second string
; Output: R1 = 0 if not the same
;              1 if R3 is substring of R4
;              2 if R4 is substring of R3
;              3 if strings are exactly equal
002520 010046
002522 010346
002524 010446

002526 011400  ; Initialize return value in R1
002530 012701  ; R3 > R4
002532 000002
002534 021314
002536 003007
002540 001404
002542 012701
002544 000001  ; R3 < R4
002546 011300
002550 000402
002552 012701  ; R3 = R4
002554 000003

002556 005203  ; Move R3 and R4 to start of data zone
002560 005203
002562 005204
002564 005204

002566 122324  ; Compare strings
002570 001402
002572 005001  ; Difference found, clear R1 and bail
002574 000401
002576 077005  ; Bottom of loop

002600 012604
002602 012603
002604 012600

002606 000207

; Convert String into 16-bit integer
; Input: R3 = string
; Output: R1 = number
002620 010046
002622 010246
002624 010446

002626 010300  ; Compute extents
002630 005200
002632 005200
002634 010046
002636 061316  ; R0 = low extent, (R6)=high extent
002640 005001  ; Clear R1
002642 012704  ; R4 = character counter
002644 000006

002646 112002  ; Read character from (R0)
002650 120227
002652 000060  ; '0'
002654 002416  ; Bail if less
002656 120227
002660 000067  ; '7'
002662 003013  ; Bail if greater
002664 020016
002666 003011  ; Bail if high extent hit
002670 162702  ; Remove ASCII bias
002672 000060
002674 006301  ; Shift result bits
002676 006301  ;  (This is done as 3 separate shifts for the
002700 006301  ;   benefit of pdp-11/03s)
002702 042702  ; Mask off low 3 bits
002704 177770 
002706 050201  ; OR bits into result
002710 077422  ; Bottom of loop

002712 012604  ; Remove high extent
002714 012604  ; Reinstate old register values
002716 012602
002720 012600
002722 000207

; Prompt user for numerical parameter
; Input: R3 = prompt string
; Output: R1 = value
002740 010246
002742 010346
002744 004737
002746 002130
002750 004737
002752 002240
002754 012703
002756 003002
002760 012713
002762 000010
002764 004737
002766 002330
002770 004737
002772 002620
002774 012603
002776 012602
003000 000207

;003002 xxxxxx  ; Buffer Space
;003004 xxxxxx
;003006 xxxxxx
;003010 xxxxxx
;003012 xxxxxx

